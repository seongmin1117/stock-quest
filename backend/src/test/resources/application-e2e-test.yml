# E2E 테스트 전용 설정
# 실제 환경과 유사한 설정으로 종합 테스트 수행

spring:
  profiles:
    active: e2e-test
  
  # 데이터베이스 설정 (Testcontainers에서 동적 할당)
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 5000
      idle-timeout: 300000
      max-lifetime: 600000
      
  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: create-drop
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: false
        jdbc:
          batch_size: 30
        order_inserts: true
        order_updates: true
    show-sql: false
    
  # Redis 설정 (Testcontainers에서 동적 할당)
  data:
    redis:
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 10
          max-idle: 10
          min-idle: 2
          max-wait: 1000ms

# 애플리케이션 보안 설정
security:
  jwt:
    secret-key: "E2E_TEST_SECRET_KEY_FOR_JWT_TOKEN_SIGNING_AND_VERIFICATION_MUST_BE_256_BITS_LONG"
    access-token-validity: 900  # 15분 (E2E 테스트용 짧은 시간)
    refresh-token-validity: 604800  # 7일
  
  password:
    min-length: 8
    require-uppercase: true
    require-lowercase: true
    require-digits: true
    require-special: true
    max-consecutive-chars: 3
    
  rate-limit:
    login:
      requests-per-minute: 10
      burst-capacity: 15
    api:
      requests-per-minute: 100
      burst-capacity: 120
      
  account-lockout:
    max-attempts: 5
    lockout-duration-minutes: 30
    ip-lockout:
      max-attempts: 3
      lockout-duration-minutes: 60

# 캐시 설정
cache:
  challenge:
    list:
      ttl-seconds: 30
      max-entries: 100
    detail:
      ttl-seconds: 300
      max-entries: 500
  user:
    profile:
      ttl-seconds: 1800
      max-entries: 1000
  market:
    data:
      ttl-seconds: 60
      max-entries: 10000

# 비동기 처리 설정
async:
  core-pool-size: 4
  max-pool-size: 8
  queue-capacity: 100
  thread-name-prefix: "e2e-async-"
  keep-alive-seconds: 60

# 성능 모니터링
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# 로깅 설정
logging:
  level:
    com.stockquest: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.testcontainers: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%logger{36}] - %msg%n"

# E2E 테스트 전용 설정
e2e:
  test:
    # 테스트 데이터 설정
    default-seed-balance: 1000000  # 100만원
    max-concurrent-users: 50
    
    # 성능 임계값
    performance:
      max-response-time: 1000  # 1초
      min-throughput: 50       # 50 req/sec
      max-error-rate: 5        # 5%
      
    # 보안 테스트 설정
    security:
      max-login-attempts: 5
      lockout-duration: 1800   # 30분
      token-expiry-test: true
      
    # 동시성 테스트 설정
    concurrency:
      thread-pool-size: 20
      max-wait-time: 30000     # 30초
      
    # 마켓 데이터 시뮬레이션
    market:
      symbols: ["AAPL", "GOOGL", "MSFT", "TSLA", "AMZN", "META", "NFLX", "NVDA", "CRM", "ADBE"]
      price-volatility: 0.05   # 5% 변동성
      update-interval: 5000    # 5초